import{ARR_OF_FORB_SITES}from"../constants/data.js";import{executeScript,storageSet,storageGet,getPureURL,setBadgeText}from"../constants/functions.js";chrome.runtime.onInstalled.addListener(e=>{"install"==e.reason?storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],e=>{e.thisWebsiteWork&&e.thisWebsiteWorkEasy||(storageSet({thisWebsiteWork:[],thisWebsiteWorkEasy:[],supervision:!0,tutorial:!0,shortCutMode:!1}),chrome.tabs.create({url:"https://romanisthere.github.io/PopUpOFF-Website/#greetings"}))}):"update"==e.reason&&(storageSet({shortCutMode:!1}),storageGet("tutorial",e=>{e.tutorial||storageSet({showUpdMess:!0})}))}),chrome.tabs.onActivated.addListener(e=>{chrome.tabs.getSelected(null,t=>{t.url.includes("chrome://")&&chrome.browserAction.disable(e.tabId)})}),chrome.tabs.onUpdated.addListener((e,t,s)=>{if("complete"===t.status||"loading"===t.status){const t=s.url;if(t.includes("chrome://"))chrome.browserAction.disable(e);else{const s=getPureURL({url:t});storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],t=>{console.log(t);const o=t.thisWebsiteWork,r=t.thisWebsiteWorkEasy;o.includes(s)?(setBadgeText("H")(e),executeScript(e)("removeHard"),executeScript(e)("watchDOM")):r.includes(s)&&(setBadgeText("E")(e),executeScript(e)("removeEasy"),executeScript(e)("watchDOMEasy"))})}}}),chrome.runtime.onMessage.addListener((e,t,s)=>{if(t.tab){const s=t.tab.id,o=getPureURL(t);e.hardMode?storageGet(["supervision","shortCutMode"],e=>{const t=e.shortCutMode;e.supervision&&ARR_OF_FORB_SITES.includes(o)||t&&storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],e=>{const r="thisWebsiteWork"==t,i=e[r?"thisWebsiteWork":"thisWebsiteWorkEasy"],a=e[r?"thisWebsiteWorkEasy":"thisWebsiteWork"];if(!i.includes(o)){setBadgeText(r?"H":"E")(s);const e=[...i,o];if(storageSet({[t]:e}),executeScript(s)(r?"removeHard":"removeEasy"),executeScript(s)(r?"watchDOM":"watchDOMEasy"),a.includes(o)){const e=a.filter(e=>e!==o);storageSet({[r?"thisWebsiteWorkEasy":"thisWebsiteWork"]:e})}}})}):e.openOptPage&&chrome.runtime.openOptionsPage()}});