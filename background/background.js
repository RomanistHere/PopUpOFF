import{ARR_OF_FORB_SITES}from"../constants/data.js";import{executeScript,storageSet,storageGet,getPureURL,setBadgeText}from"../constants/functions.js";chrome.runtime.onInstalled.addListener(e=>{"install"==e.reason?storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],e=>{e.thisWebsiteWork&&e.thisWebsiteWorkEasy||(storageSet({thisWebsiteWork:[],thisWebsiteWorkEasy:[],supervision:!0,tutorial:!0,shortCutMode:!1}),chrome.tabs.create({url:"https://romanisthere.github.io/PopUpOFF-Website/#greetings-chrome"}))}):"update"==e.reason&&chrome.tabs.create({url:"https://romanisthere.github.io/PopUpOFF-Website/pages/update.html"})}),chrome.tabs.onActivated.addListener(e=>{chrome.tabs.query({active:!0},t=>{t[0].url.includes("chrome://")&&chrome.browserAction.disable(e.tabId)})}),chrome.tabs.onUpdated.addListener((e,t,s)=>{if("complete"===t.status||"loading"===t.status){const t=s.url;if(t.includes("chrome://"))chrome.browserAction.disable(e);else{const s=getPureURL({url:t});storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],t=>{const r=t.thisWebsiteWork,o=t.thisWebsiteWorkEasy;r.includes(s)?(setBadgeText("H")(e),executeScript(e)("removeHard"),executeScript(e)("watchDOM"),executeScript(e)("showAll")):o.includes(s)&&(setBadgeText("E")(e),executeScript(e)("removeEasy"),executeScript(e)("watchDOMEasy"),executeScript(e)("showAll"))})}}}),chrome.runtime.onMessage.addListener((e,t,s)=>{if(t.tab){const r=t.tab.id,o=getPureURL(t);e.hardMode?storageGet(["supervision","shortCutMode"],e=>{const t=e.shortCutMode;e.supervision&&ARR_OF_FORB_SITES.includes(o)?s({shouldShow:!1}):t&&(s({shouldShow:!0}),storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],e=>{const s="thisWebsiteWork"==t,i=e[s?"thisWebsiteWork":"thisWebsiteWorkEasy"],a=e[s?"thisWebsiteWorkEasy":"thisWebsiteWork"];if(!i.includes(o)){setBadgeText(s?"H":"E")(r);const e=[...i,o];if(storageSet({[t]:e}),executeScript(r)(s?"removeHard":"removeEasy"),executeScript(r)(s?"watchDOM":"watchDOMEasy"),executeScript(r)("showAll"),a.includes(o)){const e=a.filter(e=>e!==o);storageSet({[s?"thisWebsiteWorkEasy":"thisWebsiteWork"]:e})}}}))}):e.openOptPage&&chrome.runtime.openOptionsPage()}return!0});