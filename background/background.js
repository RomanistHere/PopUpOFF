import{ARR_OF_FORB_SITES}from"../constants/data.js";import{storageSet,storageGet,getPureURL,activateMode,activateHard,activateEasy,executeScript,resetBadgeText}from"../constants/functions.js";chrome.runtime.onInstalled.addListener(e=>{"install"==e.reason?storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],e=>{e.thisWebsiteWork&&e.thisWebsiteWorkEasy||(storageSet({thisWebsiteWork:[],thisWebsiteWorkEasy:[],supervision:!0,tutorial:!0,shortCutMode:!1,stats:{cleanedArea:0,numbOfItems:0,restored:0},statsEnabled:!0,restoreCont:!1}),chrome.tabs.create({url:"https://romanisthere.github.io/PopUpOFF-Website/index.html#greetings-chrome"}))}):"update"==e.reason&&(chrome.tabs.create({url:"https://romanisthere.github.io/apps/popupoff/updates/#1.1.6"}),storageGet("stats",e=>{e.stats||storageSet({stats:{cleanedArea:0,numbOfItems:0,restored:0},statsEnabled:!0,restoreCont:!1})}))}),chrome.tabs.onActivated.addListener(e=>{chrome.tabs.query({active:!0},t=>{t[0].url.includes("chrome://")&&chrome.browserAction.disable(e.tabId)})}),chrome.tabs.onUpdated.addListener((e,t,s)=>{if("loading"===t.status){const t=s.url;if(t.includes("chrome://"))chrome.browserAction.disable(e);else{const s=getPureURL({url:t});storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],t=>{const o=t.thisWebsiteWork,r=t.thisWebsiteWorkEasy;o.includes(s)?activateHard(e):r.includes(s)&&activateEasy(e)})}}}),chrome.runtime.onMessage.addListener((e,t,s)=>{if(t.tab){const o=t.tab.id,r=getPureURL(t);e.hardMode?storageGet(["supervision","shortCutMode"],e=>{const t=e.shortCutMode;e.supervision&&ARR_OF_FORB_SITES.includes(r)?s({shouldShow:!1}):t&&storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],e=>{const i="thisWebsiteWork"==t,a=e[i?"thisWebsiteWork":"thisWebsiteWorkEasy"],n=e[i?"thisWebsiteWorkEasy":"thisWebsiteWork"];if(a.includes(r)){s({shouldShow:!1});const e=a.filter(e=>e!==r);storageSet({[t]:e}),executeScript(o)("restore"),resetBadgeText(o)}else{s({shouldShow:!0});const e=[...a,r];if(storageSet({[t]:e}),activateMode(i)(o),n.includes(r)){const e=n.filter(e=>e!==r);storageSet({[i?"thisWebsiteWorkEasy":"thisWebsiteWork"]:e})}}})}):e.openOptPage&&chrome.runtime.openOptionsPage()}return!0});
