import{ARR_OF_FORB_SITES}from"../constants/data.js";import{executeScript,storageSet,storageGet,getPureURL,setBadgeText}from"../constants/functions.js";chrome.runtime.onInstalled.addListener(e=>{"install"==e.reason?storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],e=>{e.thisWebsiteWork&&e.thisWebsiteWorkEasy||(storageSet({thisWebsiteWork:[],thisWebsiteWorkEasy:[],supervision:!0,tutorial:!0,shortCutMode:!1}),chrome.tabs.create({url:"https://romanisthere.github.io/PopUpOFF-Website/#greetings"}))}):e.reason}),chrome.runtime.onStartup.addListener(()=>{storageGet("showUpdMess",e=>{e.showUpdMess&&(storageSet({showUpdMess:!1}),chrome.tabs.create({url:"https://romanisthere.github.io/PopUpOFF-Website/pages/update.html"}))})}),chrome.tabs.onActivated.addListener(e=>{chrome.tabs.getSelected(null,t=>{t.url.includes("chrome://")&&chrome.browserAction.disable(e.tabId)})}),chrome.tabs.onUpdated.addListener((e,t,s)=>{if("complete"===t.status||"loading"===t.status){const t=s.url;if(t.includes("chrome://"))chrome.browserAction.disable(e);else{const s=getPureURL({url:t});storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],t=>{const r=t.thisWebsiteWork,o=t.thisWebsiteWorkEasy;r.includes(s)?(setBadgeText("H")(e),executeScript(e)("removeHard"),executeScript(e)("watchDOM"),executeScript(e)("showAll")):o.includes(s)&&(setBadgeText("E")(e),executeScript(e)("removeEasy"),executeScript(e)("watchDOMEasy"),executeScript(e)("showAll"))})}}}),chrome.runtime.onMessage.addListener((e,t,s)=>{if(t.tab){const s=t.tab.id,r=getPureURL(t);e.hardMode?storageGet(["supervision","shortCutMode"],e=>{const t=e.shortCutMode;e.supervision&&ARR_OF_FORB_SITES.includes(r)||t&&storageGet(["thisWebsiteWork","thisWebsiteWorkEasy"],e=>{const o="thisWebsiteWork"==t,i=e[o?"thisWebsiteWork":"thisWebsiteWorkEasy"],a=e[o?"thisWebsiteWorkEasy":"thisWebsiteWork"];if(!i.includes(r)){setBadgeText(o?"H":"E")(s);const e=[...i,r];if(storageSet({[t]:e}),executeScript(s)(o?"removeHard":"removeEasy"),executeScript(s)(o?"watchDOM":"watchDOMEasy"),executeScript(s)("showAll"),a.includes(r)){const e=a.filter(e=>e!==r);storageSet({[o?"thisWebsiteWorkEasy":"thisWebsiteWork"]:e})}}})}):e.openOptPage&&chrome.runtime.openOptionsPage()}});