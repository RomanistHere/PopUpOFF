import{ARR_OF_FORB_SITES,emailUrl}from"../constants/data.js";import{querySelector,isChecked,addClass,removeClass,storageSet,storageGet,executeScriptHere,getPureURL,setBadgeText,resetBadgeText}from"../constants/functions.js";let IS_SUPERVISION_ACTIVE;const toggleThisWebSiteInp=querySelector("#toggleThisWebSiteInp"),toggleEasyInpThisWebSite=querySelector("#toggleEasyInpThisWebSite"),initTutorial=()=>{const e=querySelector(".tutorial"),t=querySelector(".tutorial__next"),s=()=>{addClass(e,"tutorial-hid"),querySelector(".insturctions").textContent="Instructions",setTimeout(()=>{addClass(e,"tutorial-non")},1e3),storageSet({tutorial:!1})};querySelector(".insturctions").textContent="Tutorial",removeClass(e,"tutorial-non"),querySelector(".tutorial__agree").onclick=(()=>(addClass(e,"tutorial-transp"),addClass(e,"tutorial-step_1"),!1)),querySelector(".tutorial__skip").onclick=(()=>(s(),_gaq.push(["_trackEvent","tutorial","skip"]),!1)),querySelector(".tutorial_link-finish").onclick=(()=>(s(),_gaq.push(["_trackEvent","tutorial","pass"]),!1)),querySelector(".tutorial_to_options").onclick=(()=>(chrome.runtime.openOptionsPage(),s(),!1)),t.onclick=(()=>(addClass(e,"tutorial-step_2"),t.onclick=(()=>(addClass(e,"tutorial-step_3"),t.onclick=(()=>(addClass(e,"tutorial-step_4"),t.onclick=(()=>(removeClass(e,"tutorial-transp"),addClass(e,"tutorial-finish"),!1)),!1)),!1)),!1)),_gaq.push(["_trackEvent","tutorial","init"])},showMessage=e=>{addClass(querySelector(e),"message-visible"),".message_forb"==e?querySelector(".message_forb__link").onclick=(()=>(chrome.runtime.openOptionsPage(),removeClass(querySelector(e),"message-visible"),_gaq.push(["_trackEvent","forbid_link","clicked"]),!1)):".message_reload"==e?querySelector(".message_reload__link").onclick=(()=>(chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.update(t[0].id,{url:t[0].url}),removeClass(querySelector(e),"message-visible")}),!1)):".message_upd"==e&&(querySelector(".message_upd__link").onclick=(()=>{storageSet({showUpdMess:!1})}))},initToggler=(e,t,s,o,r,i,a)=>{e.onchange=(c=>{chrome.tabs.query({active:!0,currentWindow:!0},c=>{const n=getPureURL(c[0]),l=c[0].id;IS_SUPERVISION_ACTIVE&&ARR_OF_FORB_SITES.includes(n)?(e.checked=!1,showMessage(".message_forb"),_gaq.push(["_trackEvent","forb_site",n])):storageGet(s,c=>{const g=c[s];if(isChecked(e)){isChecked(toggleThisWebSiteInp)&&(a&&executeScriptHere("restoreEasy"),storageGet(o,e=>{const t=e[o].filter(e=>e!==n);storageSet({[o]:t})}),t.checked=!1,querySelector(r).textContent="on"),a?setBadgeText("E")(l):setBadgeText("H")(l),executeScriptHere(a?"removeEasy":"removeHard"),executeScriptHere(a?"watchDOMEasy":"watchDOM");const c=[...g,n];storageSet({[s]:c}),querySelector(i).textContent="off",_gaq.push(["_trackEvent",e,"on"])}else{isChecked(toggleThisPageInp)||(executeScriptHere("restore"),resetBadgeText(l));const t=g.filter(e=>e!==n);storageSet({[s]:t}),querySelector(i).textContent="on",_gaq.push(["_trackEvent",e,"off"])}})})})};initToggler(toggleThisWebSiteInp,toggleEasyInpThisWebSite,"thisWebsiteWork","thisWebsiteWorkEasy","#textOnOffEasyModeThisWEbsite","#textOnOffSite",!1),initToggler(toggleEasyInpThisWebSite,toggleThisWebSiteInp,"thisWebsiteWorkEasy","thisWebsiteWork","#textOnOffSite","#textOnOffEasyModeThisWEbsite",!0);const toggleThisPageInp=querySelector("#toggleThisPageInp");toggleThisPageInp.onchange=(e=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{const t=getPureURL(e[0]);IS_SUPERVISION_ACTIVE&&ARR_OF_FORB_SITES.includes(t)?(toggleThisPageInp.checked=!1,showMessage(".message_forb"),_gaq.push(["_trackEvent","forb_site",t])):isChecked(toggleThisPageInp)?(executeScriptHere("removeAll"),executeScriptHere("watchDOM"),chrome.tabs.sendMessage(e[0].id,{method:"setStatusThisPage",thisPageOn:!0}),_gaq.push(["_trackEvent","toggleThisPageInp","on"])):(isChecked(toggleThisWebSiteInp)||executeScriptHere("restoreEasy"),isChecked(toggleThisWebSiteInp)||isChecked(toggleEasyInpThisWebSite)||executeScriptHere("restore"),showMessage(".message_reload"),chrome.tabs.sendMessage(e[0].id,{method:"setStatusThisPage",thisPageOn:!1}),_gaq.push(["_trackEvent","toggleThisPageInp","off"]))})});const initState=()=>{storageGet(["tutorial","showUpdMess"],e=>{e.tutorial&&initTutorial(),e.showUpdMess&&setTimeout(()=>{showMessage(".message_upd")},100)}),chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=!1;const s=getPureURL(e[0]);storageGet("supervision",e=>{e.supervision?(IS_SUPERVISION_ACTIVE=!0,ARR_OF_FORB_SITES.includes(s)&&addClass(querySelector(".PopUpOFF"),"PopUpOFF-forb_site")):IS_SUPERVISION_ACTIVE=!1}),storageGet("thisWebsiteWork",e=>{e.thisWebsiteWork.includes(s)&&(querySelector("#toggleThisWebSiteInp").checked=!0,querySelector("#textOnOffSite").textContent="off",t=!0)}),storageGet("thisWebsiteWorkEasy",e=>{e.thisWebsiteWorkEasy.includes(s)&&!t&&(querySelector("#toggleEasyInpThisWebSite").checked=!0,querySelector("#textOnOffEasyModeThisWEbsite").textContent="off")}),chrome.tabs.sendMessage(e[0].id,{method:"getStatusThisPage"},e=>{e&&(querySelector("#toggleThisPageInp").checked=!0)})})};storageGet(["tutorial","showUpdMess"],e=>{e.tutorial&&initTutorial(),e.showUpdMess&&setTimeout(()=>{showMessage(".message_upd")},100)}),chrome.tabs.query({active:!0,currentWindow:!0},e=>{let t=!1;const s=getPureURL(e[0]);storageGet("supervision",e=>{e.supervision?(IS_SUPERVISION_ACTIVE=!0,ARR_OF_FORB_SITES.includes(s)&&addClass(querySelector(".PopUpOFF"),"PopUpOFF-forb_site")):IS_SUPERVISION_ACTIVE=!1}),storageGet("thisWebsiteWork",e=>{e.thisWebsiteWork.includes(s)&&(querySelector("#toggleThisWebSiteInp").checked=!0,querySelector("#textOnOffSite").textContent="off",t=!0)}),storageGet("thisWebsiteWorkEasy",e=>{e.thisWebsiteWorkEasy.includes(s)&&!t&&(querySelector("#toggleEasyInpThisWebSite").checked=!0,querySelector("#textOnOffEasyModeThisWEbsite").textContent="off")}),chrome.tabs.sendMessage(e[0].id,{method:"getStatusThisPage"},e=>{e&&(querySelector("#toggleThisPageInp").checked=!0)})});var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-138501898-1"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),document.getElementsByClassName("insturctions")[0].addEventListener("click",()=>{_gaq.push(["_trackEvent","instructions","clicked"])});